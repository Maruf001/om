Getting OnDA
============


.. contents::
   :local:





Accessing OnDA at the LCLS and Petra III Facilities
---------------------------------------------------

OnDA comes pre-installed at some beamlines of the Petra III and LCLS facilities:

* LCLS Facility:

  - AMO Beamline
  - CXI Beamline

* Petra III Facility

  - P11 Beamline

Beamline scientists can provide information on how to access and use OnDA. However, for
reference, instructions can also be found in the following paragraphs.


LCLS Facility - AMO and CXI Beamlines
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

In order to run OnDA at these beamlines, access to the monitoring nodes is needed. They
are the only machines which can access the real-time data stream. Once access has been
granted, the latest version of OnDA can be reached by activating an `Anaconda
<https://anaconda.org/>`_ python environment:

.. code-block:: bash

    # On one of the monitoring nodes, for example, daq-cxi-mon07
    source /reg/g/cfel/onda/onda.sh


Petra III - P11
^^^^^^^^^^^^^^^

OnDA is available at this beamline on the 'eval01' machine and must be run on it. Once
logged in, the following command can be used to activate the `Anaconda
<https://anaconda.org/>`_ python environment in which OnDA is installed:

.. code-block:: bash

    # On eval01.desy.de
    source /home/p11user/CfelSoft/onda/onda.sh





Installing OnDA on a Local Machine
----------------------------------

OnDA can easily be installed on a local machine from the `Python Package Index
<https://pypi.org/>`_. It is also available as a package for the `Anaconda
<https://anaconda.org/>`_ Python distribution.


Installation from the Python Package Index
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

OnDA can be installed from the Python Package Index (PyPI) using the 'pip' command.
This is the preferred installation method. The only requirements are:

* An actively supported version of Python (2.7, 3.5, 3.6, or 3.7).

* The 'pip' utility for the corresponding version of python.

**Python 3:**

It is recommended to install OnDA in a clean Python virtual environment. The
environment can be created using  the
`venv <https://docs.python.org/3/library/venv.html>`_ module from the Python 3
Standard Library:

.. code-block:: bash

    python3 -m venv onda_env

The environment can be activated by sourcing a file:

.. code-block:: bash

    source onda_env/bin/activate

Finally, OnDA can be installed using the 'pip' command.
In order to install only the monitoring part of OnDA (without the graphical
interfaces):

.. code-block:: bash

    python3 -m pip install onda

In order to install OnDA together with the Qt5-based graphical interfaces:

.. code-block:: bash

    python3 -m pip install onda[GUI]

When the **mpi** Parallelization Layer is used (It is currently used by default), the
*mpi4py* module needs to be installed. This requires a version of the MPI libraries and
headers to be installed on the machine.

.. code-block:: bash

    python3 -m pip install mpi4py


**Python 2:**

For Python 2, the process, is very similar, except that the `virtualenv
<https://virtualenv.pypa.io/en/stable/>`_ tool must be used to create the enviroment:


.. code-block:: bash

    python2 -m virtualenv onda_env

The rest of the process is then identical:

.. code-block:: bash

    source onda_env/bin/activate

Then:

.. code-block:: bash

    python2 -m pip install onda

Or:

.. code-block:: bash

    python2 -m pip install onda[GUI]

When the *mpi* Parallelization Layer is used, the *mpi4py* module must also be
installed.

.. code-block:: bash

    python2 -m pip install mpi4py


Installation in Anaconda
^^^^^^^^^^^^^^^^^^^^^^^^

**Python 3:**

Packages for OnDA and its dependencies are available from the 'ondateam' channel of
https://anaconda.org. It is reccomended to install onda in a clean Python enviroment,
which can be created using the following command:

.. code-block:: bash

    conda create -n onda_env python=3

The enviroment can then be activated using the following command:

.. code-block:: bash

    conda activate onda_env

Finally, OnDA can be installed using the 'conda install' command:

.. code-block:: bash

    conda install --channel conda-forge --channel ondateam onda

**Python 2:**

For Python 2 the process is very similar:

.. code-block:: bash

    conda create -n onda_env python=2

Then:

.. code-block:: bash

    conda activate onda_env

And:

.. code-block:: bash

    conda install --channel conda-forge --channel ondateam onda


Once access to OnDA has been obtained at one of the supported facilities, or OnDA has
been installed on a local machine, information on how to run it can be found
:doc:`here <documentation_running_onda>`.
